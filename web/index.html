<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholastic Go Tutorial</title>
    <style>
        /* CSS styling for the tutorial interface */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin: 30px 0;
            padding: 20px;
            border-left: 4px solid #3498db;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .section h2 {
            color: #2980b9;
            margin-top: 0;
        }
        
        .api-endpoint {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        
        .code-block {
            background-color: #34495e;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background-color: #2980b9;
        }
        
        .button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .response {
            background-color: #e8f5e8;
            border: 1px solid #27ae60;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        
        .error {
            background-color: #fdf2f2;
            border: 1px solid #e74c3c;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            color: #c0392b;
        }
        
        .loading {
            color: #3498db;
            font-style: italic;
        }
        
        .go-concepts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .concept-card {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .concept-card h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online {
            background-color: #27ae60;
        }
        
        .status-offline {
            background-color: #e74c3c;
        }
        
        .console-output {
            background-color: #1e1e1e;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .console-line {
            margin: 2px 0;
        }
        
        .console-info {
            color: #66d9ef;
        }
        
        .console-success {
            color: #a6e22e;
        }
        
        .console-error {
            color: #f92672;
        }
        
        .console-warning {
            color: #fd971f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì Scholastic Go Tutorial</h1>
        <p style="text-align: center; font-size: 18px; color: #7f8c8d;">
            Learn Go programming through interactive HTTP client-server communication
        </p>

        <!-- Server Status Section -->
        <div class="section">
            <h2>üîå Server Status</h2>
            <div id="server-status">
                <span class="status-indicator status-offline"></span>
                <span>Connecting to server...</span>
            </div>
            <button class="button" onclick="checkServerStatus()">Check Status</button>
            <div id="status-response"></div>
        </div>

        <!-- API Endpoints Section -->
        <div class="section">
            <h2>üåê API Endpoints</h2>
            <p>Explore the available API endpoints and their functionality:</p>
            
            <div class="api-endpoint">GET /health - Server health check</div>
            <button class="button" onclick="testHealthCheck()">Test Health Check</button>
            
            <div class="api-endpoint">GET /api/users - Get all users</div>
            <button class="button" onclick="getUsers()">Get Users</button>
            
            <div class="api-endpoint">POST /api/users - Create new user</div>
            <button class="button" onclick="createUser()">Create User</button>
            
            <div class="api-endpoint">POST /api/calculate - Mathematical calculations</div>
            <button class="button" onclick="testCalculations()">Test Calculations</button>
            
            <div class="api-endpoint">POST /api/goroutines - Goroutine demonstrations</div>
            <button class="button" onclick="testGoroutines()">Test Goroutines</button>
            
            <div class="api-endpoint">GET /ws - WebSocket simulation</div>
            <button class="button" onclick="testWebSocket()">Test WebSocket</button>
            
            <div id="api-response"></div>
        </div>

        <!-- Go Concepts Section -->
        <div class="section">
            <h2>üéØ Go Concepts Demonstrated</h2>
            <div class="go-concepts">
                <div class="concept-card">
                    <h3>üîß Structs and Interfaces</h3>
                    <p>Learn how Go uses structs for data modeling and interfaces for abstraction.</p>
                    <div class="code-block">
type User struct {
    ID       int    `json:"id"`
    Username string `json:"username"`
    Email    string `json:"email"`
}

type UserService interface {
    GetUserByID(id int) (*User, error)
    CreateUser(user *User) error
}
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>ü¶ç Goroutines and Concurrency</h3>
                    <p>Explore Go's lightweight concurrency model with goroutines and channels.</p>
                    <div class="code-block">
go func() {
    // Run concurrent task
    result := processData(data)
    resultsChannel <- result
}()
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>üîÑ HTTP Middleware</h3>
                    <p>Understand how to implement HTTP middleware for cross-cutting concerns.</p>
                    <div class="code-block">
func LoggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        log.Printf("Request: %s %s", r.Method, r.URL.Path)
        next.ServeHTTP(w, r)
    })
}
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>üì¶ Package Organization</h3>
                    <p>Learn proper Go project structure and package organization.</p>
                    <div class="code-block">
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îî‚îÄ‚îÄ client/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îî‚îÄ‚îÄ web/
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>üõ°Ô∏è Error Handling</h3>
                    <p>Master Go's explicit error handling patterns and best practices.</p>
                    <div class="code-block">
result, err := doSomething()
if err != nil {
    return fmt.Errorf("failed to do something: %w", err)
}
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>‚öôÔ∏è Configuration Management</h3>
                    <p>Implement flexible configuration with environment variables and validation.</p>
                    <div class="code-block">
type Config struct {
    ServerPort string `env:"SERVER_PORT" default:"8080"`
    DebugMode  bool   `env:"DEBUG_MODE" default:"false"`
}
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Console Section -->
        <div class="section">
            <h2>üñ•Ô∏è Interactive Console</h2>
            <p>Monitor client-server communication in real-time:</p>
            <div class="console-output" id="console">
                <div class="console-line console-info">Console initialized. Click buttons above to start demonstrations.</div>
            </div>
            <button class="button" onclick="clearConsole()">Clear Console</button>
            <button class="button" onclick="runFullDemo()">Run Full Demo</button>
        </div>

        <!-- Code Examples Section -->
        <div class="section">
            <h2>üíª Code Examples</h2>
            <p>View and learn from the actual Go code implementing these features:</p>
            
            <button class="button" onclick="showCodeExample('server')">Server Main</button>
            <button class="button" onclick="showCodeExample('config')">Configuration</button>
            <button class="button" onclick="showCodeExample('handlers')">HTTP Handlers</button>
            <button class="button" onclick="showCodeExample('client')">HTTP Client</button>
            <button class="button" onclick="showCodeExample('middleware')">Middleware</button>
            
            <div id="code-example"></div>
        </div>
    </div>

    <script>
        // JavaScript for interactive functionality
        
        // Console logging function
        function logToConsole(message, type = 'info') {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        // Clear console
        function clearConsole() {
            document.getElementById('console').innerHTML = 
                '<div class="console-line console-info">Console cleared.</div>';
        }

        // Check server status
        async function checkServerStatus() {
            logToConsole('Checking server status...', 'info');
            const statusDiv = document.getElementById('server-status');
            const responseDiv = document.getElementById('status-response');
            
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = '<span class="status-indicator status-online"></span><span>Server is online</span>';
                    responseDiv.innerHTML = `<div class="response">Server Status: ${data.message}</div>`;
                    logToConsole('‚úÖ Server is online and healthy', 'success');
                } else {
                    statusDiv.innerHTML = '<span class="status-indicator status-offline"></span><span>Server is offline</span>';
                    responseDiv.innerHTML = `<div class="error">Failed to connect to server</div>`;
                    logToConsole('‚ùå Server health check failed', 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="status-indicator status-offline"></span><span>Server is offline</span>';
                responseDiv.innerHTML = `<div class="error">Connection error: ${error.message}</div>`;
                logToConsole(`‚ùå Connection error: ${error.message}`, 'error');
            }
        }

        // Test health check endpoint
        async function testHealthCheck() {
            logToConsole('Testing health check endpoint...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                responseDiv.innerHTML = `<div class="response">${JSON.stringify(data, null, 2)}</div>`;
                logToConsole('‚úÖ Health check completed successfully', 'success');
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå Health check error: ${error.message}`, 'error');
            }
        }

        // Get users
        async function getUsers() {
            logToConsole('Fetching users from server...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            try {
                const response = await fetch('/api/users');
                const data = await response.json();
                
                responseDiv.innerHTML = `<div class="response">${JSON.stringify(data, null, 2)}</div>`;
                logToConsole(`‚úÖ Retrieved ${data.data ? data.data.length : 0} users`, 'success');
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå Get users error: ${error.message}`, 'error');
            }
        }

        // Create user
        async function createUser() {
            logToConsole('Creating new user...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            const userData = {
                username: 'web_demo_user',
                email: 'webdemo@example.com',
                first_name: 'Web',
                last_name: 'Demo',
                age: 25,
                active: true,
                roles: ['user', 'demo']
            };
            
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    responseDiv.innerHTML = `<div class="response">${JSON.stringify(data, null, 2)}</div>`;
                    logToConsole('‚úÖ User created successfully', 'success');
                } else {
                    responseDiv.innerHTML = `<div class="error">Error: ${JSON.stringify(data, null, 2)}</div>`;
                    logToConsole(`‚ùå User creation failed: ${data.error}`, 'error');
                }
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå Create user error: ${error.message}`, 'error');
            }
        }

        // Test calculations
        async function testCalculations() {
            logToConsole('Testing mathematical calculations...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            const calcData = {
                operation: 'add',
                a: 10.5,
                b: 20.3,
                precision: 2
            };
            
            try {
                const response = await fetch('/api/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(calcData)
                });
                
                const data = await response.json();
                
                responseDiv.innerHTML = `<div class="response">${JSON.stringify(data, null, 2)}</div>`;
                logToConsole('‚úÖ Calculation completed', 'success');
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå Calculation error: ${error.message}`, 'error');
            }
        }

        // Test goroutines
        async function testGoroutines() {
            logToConsole('Testing goroutine demonstration...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            const goroutineData = {
                task_type: 'basic',
                task_count: 5,
                delay_ms: 100,
                description: 'Web client goroutine test'
            };
            
            try {
                const response = await fetch('/api/goroutines', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(goroutineData)
                });
                
                const data = await response.json();
                
                responseDiv.innerHTML = `<div class="response">${JSON.stringify(data, null, 2)}</div>`;
                logToConsole('‚úÖ Goroutine demonstration completed', 'success');
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå Goroutine test error: ${error.message}`, 'error');
            }
        }

        // Test WebSocket
        async function testWebSocket() {
            logToConsole('Testing WebSocket simulation...', 'info');
            const responseDiv = document.getElementById('api-response');
            
            try {
                // First, get connected users
                const usersResponse = await fetch('/ws');
                const usersData = await usersResponse.json();
                
                // Then, send a broadcast message
                const messageData = {
                    type: 'broadcast',
                    from: 'web_client',
                    content: { text: 'Hello from web client!' },
                    timestamp: Math.floor(Date.now() / 1000)
                };
                
                const messageResponse = await fetch('/ws', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(messageData)
                });
                
                const messageResult = await messageResponse.json();
                
                responseDiv.innerHTML = `<div class="response">
Connected Users: ${JSON.stringify(usersData.data, null, 2)}
Message Result: ${JSON.stringify(messageResult, null, 2)}
</div>`;
                logToConsole('‚úÖ WebSocket simulation completed', 'success');
            } catch (error) {
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                logToConsole(`‚ùå WebSocket test error: ${error.message}`, 'error');
            }
        }

        // Show code examples
        function showCodeExample(example) {
            const codeDiv = document.getElementById('code-example');
            const examples = {
                server: `// cmd/server/main.go - Main server entry point
func main() {
    // Load configuration
    config, err := config.LoadConfig()
    if err != nil {
        log.Fatalf("Failed to load configuration: %v", err)
    }
    
    // Initialize services
    userService := services.NewUserService(config)
    mathService := services.NewMathService()
    
    // Create HTTP server with middleware
    mux := http.NewServeMux()
    mux.HandleFunc("/health", apiHandler.HealthCheck)
    mux.HandleFunc("/api/users", apiHandler.UsersHandler)
    
    // Start server
    server := &http.Server{
        Addr:    ":" + config.ServerPort,
        Handler: middleware.CommonMiddleware(mux),
    }
    
    log.Fatal(server.ListenAndServe())
}`,
                
                config: `// internal/config/config.go - Configuration management
type Config struct {
    ServerPort  string        \`json:"server_port"\`
    DebugMode   bool          \`json:"debug_mode"\`
    Environment string        \`json:"environment"\`
    ReadTimeout time.Duration \`json:"read_timeout"\`
}

func LoadConfig() (*Config, error) {
    config := &Config{
        ServerPort:  getEnvOrDefault("SERVER_PORT", "8080"),
        DebugMode:   getEnvBoolOrDefault("DEBUG_MODE", false),
        Environment: getEnvOrDefault("ENVIRONMENT", "development"),
    }
    
    // Validate configuration
    if err := config.Validate(); err != nil {
        return nil, fmt.Errorf("validation failed: %w", err)
    }
    
    return config, nil
}`,
                
                handlers: `// internal/handlers/handlers.go - HTTP request handlers
type APIHandler struct {
    userService UserServiceInterface
    mathService MathServiceInterface
}

func (h *APIHandler) HealthCheck(w http.ResponseWriter, r *http.Request) {
    response := models.SuccessResponse{
        Message: "Server is healthy and running",
        Data: map[string]interface{}{
            "status":    "healthy",
            "timestamp": time.Now().Unix(),
        },
    }
    
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

func (h *APIHandler) UsersHandler(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodGet:
        h.getUsers(w, r)
    case http.MethodPost:
        h.createUser(w, r)
    default:
        sendErrorResponse(w, "Method not allowed", 
            http.StatusMethodNotAllowed)
    }
}`,
                
                client: `// cmd/client/main.go - HTTP client demonstration
type HTTPClient struct {
    client    *http.Client
    config    *ClientConfig
    baseURL   string
    authToken string
    debug     bool
}

func (c *HTTPClient) executeWithRetry(req *http.Request, maxRetries int) (*http.Response, error) {
    var lastErr error
    
    for attempt := 0; attempt <= maxRetries; attempt++ {
        if attempt > 0 {
            delay := time.Duration(attempt) * c.config.RetryDelay
            time.Sleep(delay)
        }
        
        resp, err := c.client.Do(req)
        if err != nil {
            lastErr = err
            continue
        }
        
        if resp.StatusCode >= 200 && resp.StatusCode < 300 {
            return resp, nil
        }
        
        resp.Body.Close()
        lastErr = fmt.Errorf("status code: %d", resp.StatusCode)
    }
    
    return nil, fmt.Errorf("all retry attempts failed: %w", lastErr)
}`,
                
                middleware: `// internal/middleware/middleware.go - HTTP middleware
func LoggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        requestID := generateRequestID()
        
        log.Printf("Request %s: %s %s", 
            requestID, r.Method, r.URL.Path)
        
        wrapper := &responseWriterWrapper{
            ResponseWriter: w,
            statusCode:     http.StatusOK,
        }
        
        startTime := time.Now()
        next.ServeHTTP(wrapper, r)
        
        duration := time.Since(startTime)
        log.Printf("Response %s: Status=%d Duration=%v",
            requestID, wrapper.statusCode, duration)
    })
}

func RecoveryMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        defer func() {
            if err := recover(); err != nil {
                log.Printf("Panic recovered: %v\\n%s", err, debug.Stack())
                http.Error(w, "Internal server error", 
                    http.StatusInternalServerError)
            }
        }()
        
        next.ServeHTTP(w, r)
    })
}`
            };
            
            codeDiv.innerHTML = `<div class="code-block">${examples[example]}</div>`;
        }

        // Run full demonstration
        async function runFullDemo() {
            logToConsole('üöÄ Starting full demonstration...', 'info');
            
            const demos = [
                checkServerStatus,
                testHealthCheck,
                getUsers,
                createUser,
                testCalculations,
                testGoroutines,
                testWebSocket
            ];
            
            for (let i = 0; i < demos.length; i++) {
                logToConsole(`Running demonstration ${i + 1} of ${demos.length}...`, 'info');
                await demos[i]();
                await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second between demos
            }
            
            logToConsole('üéâ Full demonstration completed!', 'success');
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            logToConsole('üåê Web interface loaded successfully', 'success');
            checkServerStatus();
        });
    </script>
</body>
</html>